import{c as E,u as ze,a as B,b as j,d as e,r as o,e as we,o as O,w as t,f as i,t as $,g as k,h as Oe,i as z,j as se,k as ne,l as ue,E as h,F as oe,m as ie,n as W,p as Q,q as fe,s as Ne,v as ke,x as _e,y as le,z as Se,A as Me,B as Pe,C as Ie}from"./vendor-LtDZf8KO.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))p(u);new MutationObserver(u=>{for(const _ of u)if(_.type==="childList")for(const c of _.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&p(c)}).observe(document,{childList:!0,subtree:!0});function r(u){const _={};return u.integrity&&(_.integrity=u.integrity),u.referrerPolicy&&(_.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?_.credentials="include":u.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function p(u){if(u.ep)return;u.ep=!0;const _=r(u);fetch(u.href,_)}})();const H=(s,l)=>{const r=s.__vccOpts||s;for(const[p,u]of l)r[p]=u;return r},Be={key:0,class:"login-wrapper"},Te={class:"user-meta"},Ue={class:"user-name"},Ae={__name:"App",setup(s){const l=ze(),r=we(),p=E(()=>l.path),u=E(()=>l.path==="/login"),_=E(()=>localStorage.getItem("username")||""),c=()=>{localStorage.removeItem("token"),localStorage.removeItem("username"),r.push("/login")};return(S,n)=>{const b=o("router-view"),N=o("el-icon"),m=o("el-menu-item"),d=o("el-menu"),I=o("el-aside"),U=o("el-button"),y=o("el-header"),v=o("el-main"),g=o("el-container");return u.value?(O(),B("div",Be,[e(b)])):(O(),j(g,{key:1,class:"layout"},{default:t(()=>[e(I,{width:"220px",class:"aside"},{default:t(()=>[n[8]||(n[8]=i("div",{class:"brand"},"OpenVPN Web",-1)),e(d,{"default-active":p.value,class:"menu",router:""},{default:t(()=>[e(m,{index:"/"},{default:t(()=>[e(N,null,{default:t(()=>[...n[0]||(n[0]=[i("i",{class:"ri-dashboard-line"},null,-1)])]),_:1}),n[1]||(n[1]=i("span",null,"仪表盘",-1))]),_:1}),e(m,{index:"/servers"},{default:t(()=>[e(N,null,{default:t(()=>[...n[2]||(n[2]=[i("i",{class:"ri-server-line"},null,-1)])]),_:1}),n[3]||(n[3]=i("span",null,"服务器管理",-1))]),_:1}),e(m,{index:"/clients"},{default:t(()=>[e(N,null,{default:t(()=>[...n[4]||(n[4]=[i("i",{class:"ri-user-3-line"},null,-1)])]),_:1}),n[5]||(n[5]=i("span",null,"客户端管理",-1))]),_:1}),e(m,{index:"/logs"},{default:t(()=>[e(N,null,{default:t(()=>[...n[6]||(n[6]=[i("i",{class:"ri-file-list-3-line"},null,-1)])]),_:1}),n[7]||(n[7]=i("span",null,"日志审计",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(g,null,{default:t(()=>[e(y,{class:"header"},{default:t(()=>[n[10]||(n[10]=i("div",{class:"title"},"OpenVPN Web管理系统",-1)),i("div",Te,[i("span",Ue,$(_.value||"管理员"),1),e(U,{size:"small",text:"",type:"danger",onClick:c},{default:t(()=>[...n[9]||(n[9]=[k("退出",-1)])]),_:1})])]),_:1}),e(v,{class:"main"},{default:t(()=>[e(b)]),_:1})]),_:1})]),_:1}))}}},Le=H(Ae,[["__scopeId","data-v-5b89dd8f"]]),Ee="/ovpnmanager",T=Oe.create({baseURL:"http://192.168.1.182/api",timeout:8e3});T.interceptors.request.use(s=>{const l=localStorage.getItem("token");return l&&(s.headers.Authorization=`Bearer ${l}`),s});T.interceptors.response.use(s=>s,s=>{var r,p,u;const l=((p=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:p.detail)||s.message||"请求失败";return((u=s==null?void 0:s.response)==null?void 0:u.status)===401&&(localStorage.removeItem("token"),window.location.href=`${Ee}/login`),Promise.reject(new Error(l))});const De=()=>T.get("/dashboard/metrics"),re=s=>{if(!s)return"";const l=new Date(s);return Number.isNaN(l.getTime())?s:new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(l).replace(/\//g,"/").replace(",","")},Re={class:"page"},je={class:"card-header"},Fe={class:"title"},qe={class:"value"},Ke={class:"desc"},Ye={key:0},We={class:"activity-line"},He={class:"actor"},Je={class:"action"},Xe={key:0,class:"target"},Ge={key:1,class:"action"},Ze={class:"panel-header"},Qe={key:0},et={class:"activity-line"},tt={class:"actor spaced"},at={class:"action spaced"},nt={key:0,class:"target spaced"},st={__name:"DashboardView",setup(s){const l=z(!1),r=z({online_clients:0,total_clients:0,certificates:{total:0,valid:0,revoked:0,expired:0},openvpn:{status:"unknown"},alerts:{count:0}}),p=z([]),u=z([]),_=z([]),c=E(()=>r.value.openvpn.status==="running"?"success":r.value.openvpn.status==="stopped"?"danger":"warning"),S=E(()=>[{title:"在线客户端",value:r.value.online_clients,desc:`共 ${r.value.total_clients} 个客户端`,tag:"实时",tagType:"success"},{title:"证书总数",value:r.value.certificates.total,desc:`有效 ${r.value.certificates.valid} | 吊销 ${r.value.certificates.revoked} | 过期 ${r.value.certificates.expired}`,tag:"证书",tagType:"info"},{title:"OpenVPN 服务",value:r.value.openvpn.status==="running"?"运行中":r.value.openvpn.status,desc:"systemd 状态",tag:"服务端",tagType:c.value},{title:"告警",value:r.value.alerts.count,desc:"最近24小时",tag:"告警",tagType:r.value.alerts.count>0?"danger":"success"}]),n=async()=>{var y,v;l.value=!0;try{const{data:g}=await De();r.value=g,p.value=g.recent_activity||[],u.value=((y=g.openvpn)==null?void 0:y.routing_table)||[],_.value=((v=g.openvpn)==null?void 0:v.state_events)||[]}catch(g){h.error(g.message)}finally{l.value=!1}},b=y=>{if(y==null)return"-";const v=["B","KB","MB","GB","TB"];let g=0,w=Number(y);for(;w>=1024&&g<v.length-1;)w/=1024,g+=1;return`${w.toFixed(w>=10||g===0?0:1)} ${v[g]}`},N=y=>{if(!y||y<0)return"-";const v=Math.floor(y/86400),g=Math.floor(y%86400/3600),w=Math.floor(y%3600/60);return v?`${v}天 ${g}小时`:g?`${g}小时 ${w}分`:`${w}分`},m=E(()=>r.value.openvpn||{});E(()=>{var v;const y=(v=m.value.load_stats)==null?void 0:v.uptime;if(y)return N(y);if(m.value.time_unix){const g=Math.floor(Date.now()/1e3)-m.value.time_unix;return N(g)}return"-"});const d=(...y)=>{const v=m.value.global_stats||{};for(const g of y){if(v[g]!==void 0)return v[g];const w=Object.keys(v).find(R=>R.toLowerCase()===g.toLowerCase());if(w)return v[w]}return null},I=E(()=>{var y;return((y=m.value.load_stats)==null?void 0:y.bytes_in)!=null?m.value.load_stats.bytes_in:d("bytesin","BYTESIN","bytes_in")}),U=E(()=>{var y;return((y=m.value.load_stats)==null?void 0:y.bytes_out)!=null?m.value.load_stats.bytes_out:d("bytesout","BYTESOUT","bytes_out")});return E(()=>{var y;return(y=d("MaxConn","MAXCONN","maxconn","max_conn"))!=null?y:"-"}),E(()=>{var y;return(y=d("MaxBcast","MAXBCAST","maxbcast","max_bcast"))!=null?y:"-"}),se(n),(y,v)=>{const g=o("el-tag"),w=o("el-card"),R=o("el-col"),L=o("el-row"),J=o("el-descriptions-item"),X=o("el-descriptions"),F=o("el-timeline-item"),Y=o("el-timeline"),G=o("el-empty"),D=o("el-table-column"),ee=o("el-table"),Z=o("el-button"),M=ue("loading");return O(),B("div",Re,[ne((O(),j(L,{gutter:16,class:"cards"},{default:t(()=>[(O(!0),B(oe,null,ie(S.value,V=>(O(),j(R,{span:6,key:V.title},{default:t(()=>[e(w,{shadow:"hover",class:"stat-card"},{default:t(()=>[i("div",je,[i("div",Fe,$(V.title),1),e(g,{type:V.tagType,effect:"dark",size:"small"},{default:t(()=>[k($(V.tag),1)]),_:2},1032,["type"])]),i("div",qe,$(V.value),1),i("div",Ke,$(V.desc),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})),[[M,l.value]]),e(L,{gutter:16,class:"cards"},{default:t(()=>[e(R,{span:12},{default:t(()=>[e(w,{shadow:"never",class:"panel full-height"},{header:t(()=>[...v[0]||(v[0]=[i("div",{class:"panel-header"},[i("span",null,"OpenVPN 概览")],-1)])]),default:t(()=>[e(X,{column:1,border:"",size:"small"},{default:t(()=>[e(J,{label:"版本/标题"},{default:t(()=>[k($(m.value.title||"未知"),1)]),_:1}),e(J,{label:"累计流量"},{default:t(()=>[k(" 入 "+$(b(I.value))+" / 出 "+$(b(U.value)),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{span:12},{default:t(()=>[e(w,{shadow:"never",class:"panel full-height"},{header:t(()=>[...v[1]||(v[1]=[i("div",{class:"panel-header"},[i("span",null,"最近连接事件")],-1)])]),default:t(()=>[_.value.length?(O(),B("div",Ye,[e(Y,null,{default:t(()=>[(O(!0),B(oe,null,ie(_.value,(V,te)=>(O(),j(F,{key:te,timestamp:W(re)(V.timestamp*1e3),type:V.state==="CONNECTED"?"success":"info"},{default:t(()=>[i("div",We,[i("span",He,$(V.common_name||"N/A"),1),i("span",Je,$(V.state),1),V.real_address?(O(),B("span",Xe,"("+$(V.real_address)+")",1)):Q("",!0),V.detail?(O(),B("div",Ge,$(V.detail),1)):Q("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):(O(),j(G,{key:1,description:"暂无连接事件"}))]),_:1})]),_:1})]),_:1}),e(w,{shadow:"never",class:"panel"},{header:t(()=>[...v[2]||(v[2]=[i("div",{class:"panel-header"},[i("span",null,"路由表")],-1)])]),default:t(()=>[ne((O(),j(ee,{data:u.value,size:"small","empty-text":"暂无路由"},{default:t(()=>[e(D,{prop:"virtual_address",label:"虚拟地址"}),e(D,{prop:"real_address",label:"公网地址"}),e(D,{prop:"common_name",label:"客户端"}),e(D,{label:"最近活动"},{default:t(({row:V})=>[k($(W(re)(V.last_ref*1e3)),1)]),_:1})]),_:1},8,["data"])),[[M,l.value]])]),_:1}),e(w,{shadow:"never",class:"panel"},{header:t(()=>[i("div",Ze,[v[4]||(v[4]=i("span",null,"近期活动",-1)),e(Z,{size:"small",text:"",type:"primary",onClick:n,loading:l.value},{default:t(()=>[...v[3]||(v[3]=[k("刷新",-1)])]),_:1},8,["loading"])])]),default:t(()=>[p.value.length?(O(),B("div",Qe,[e(Y,null,{default:t(()=>[(O(!0),B(oe,null,ie(p.value,(V,te)=>(O(),j(F,{key:te,timestamp:W(re)(V.created_at),type:V.result==="success"?"success":"danger"},{default:t(()=>[i("div",et,[i("span",tt,$(V.actor),1),i("span",at,$(V.action),1),V.target?(O(),B("span",nt,"("+$(V.target)+")",1)):Q("",!0),e(g,{class:"spaced",size:"small",type:V.result==="success"?"success":"danger"},{default:t(()=>[k($(V.result),1)]),_:2},1032,["type"])])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):(O(),j(G,{key:1,description:"暂无活动记录"}))]),_:1})])}}},lt=H(st,[["__scopeId","data-v-0c216de8"]]),ot=()=>T.get("/servers"),it=()=>T.get("/servers/config"),rt=s=>T.put("/servers/config",s),ut=s=>T.post(`/servers/control/${s}`),dt={class:"page"},ct={class:"server-header"},pt={class:"controls"},mt={class:"status-panel"},_t={class:"server-header"},ft={class:"controls"},vt={__name:"ServersView",setup(s){const l=z({}),r=z(!1),p=z(""),u=z(""),_=z("尚未查询"),c=async()=>{r.value=!0;try{const{data:m}=await ot();l.value=(m==null?void 0:m[0])||{}}catch(m){h.error(m.message)}finally{r.value=!1}},S=async()=>{r.value=!0;try{const{data:m}=await it();p.value=m.content||""}catch(m){h.error(m.message)}finally{r.value=!1}},n=async()=>{try{await rt({content:p.value}),h.success("配置已保存")}catch(m){h.error(m.message)}},b=m=>{if(!m)return"";const d=m.status?`status=${m.status}`:"",I=m.result?m.result.replace(/\s+/g," ").trim():"ok";return[m.action,d,I].filter(Boolean).join(" | ")},N=async m=>{try{const{data:d}=await ut(m);u.value=b(d),_.value=d.result||JSON.stringify(d,null,2),h.success("操作成功"),await c()}catch(d){h.error(d.message)}};return se(()=>{c(),S(),N("status")}),(m,d)=>{const I=o("el-button"),U=o("el-descriptions-item"),y=o("el-tag"),v=o("el-descriptions"),g=o("el-input"),w=o("el-card"),R=ue("loading");return ne((O(),B("div",dt,[e(w,{class:"server-card",shadow:"never"},{header:t(()=>[i("div",ct,[d[10]||(d[10]=i("div",{class:"meta"},[i("div",{class:"title"},"OpenVPN 服务端"),i("div",{class:"desc"},"单实例管理，支持启停/重启/状态查询")],-1)),i("div",pt,[e(I,{size:"small",onClick:d[0]||(d[0]=L=>N("status"))},{default:t(()=>[...d[6]||(d[6]=[k("查询状态",-1)])]),_:1}),e(I,{size:"small",type:"success",onClick:d[1]||(d[1]=L=>N("start"))},{default:t(()=>[...d[7]||(d[7]=[k("启动",-1)])]),_:1}),e(I,{size:"small",type:"warning",onClick:d[2]||(d[2]=L=>N("restart"))},{default:t(()=>[...d[8]||(d[8]=[k("重启",-1)])]),_:1}),e(I,{size:"small",type:"danger",onClick:d[3]||(d[3]=L=>N("stop"))},{default:t(()=>[...d[9]||(d[9]=[k("停止",-1)])]),_:1})])])]),default:t(()=>[e(v,{column:3,border:""},{default:t(()=>[e(U,{label:"名称"},{default:t(()=>[k($(l.value.name||"-"),1)]),_:1}),e(U,{label:"主机"},{default:t(()=>[k($(l.value.host||"-"),1)]),_:1}),e(U,{label:"端口"},{default:t(()=>[k($(l.value.port||"-"),1)]),_:1}),e(U,{label:"协议"},{default:t(()=>[k($(l.value.protocol||"-"),1)]),_:1}),e(U,{label:"VPN 网关"},{default:t(()=>[k($(l.value.vpn_ip||"-"),1)]),_:1}),e(U,{label:"状态"},{default:t(()=>[e(y,{type:l.value.status==="running"?"success":"info"},{default:t(()=>[k($(l.value.status||"unknown"),1)]),_:1},8,["type"])]),_:1})]),_:1}),i("div",mt,[d[11]||(d[11]=i("div",{class:"panel-header"},"OpenVPN 服务状态输出",-1)),e(g,{type:"textarea",rows:10,modelValue:_.value,"onUpdate:modelValue":d[4]||(d[4]=L=>_.value=L),readonly:""},null,8,["modelValue"])])]),_:1}),e(w,{class:"server-card",shadow:"never"},{header:t(()=>[i("div",_t,[d[14]||(d[14]=i("div",{class:"meta"},[i("div",{class:"title"},"server.conf 配置"),i("div",{class:"desc"},"编辑后保存生效（保存后建议重启 OpenVPN）")],-1)),i("div",ft,[e(I,{size:"small",onClick:S},{default:t(()=>[...d[12]||(d[12]=[k("重新加载",-1)])]),_:1}),e(I,{size:"small",type:"primary",onClick:n},{default:t(()=>[...d[13]||(d[13]=[k("保存配置",-1)])]),_:1})])])]),default:t(()=>[e(g,{modelValue:p.value,"onUpdate:modelValue":d[5]||(d[5]=L=>p.value=L),type:"textarea",rows:16,resize:"vertical",placeholder:"server.conf 内容"},null,8,["modelValue"])]),_:1})])),[[R,r.value]])}}},gt=H(vt,[["__scopeId","data-v-4dda35b8"]]),yt=(s={})=>T.get("/clients",{params:s}),bt=s=>T.post("/clients",s),wt=(s,l)=>T.patch(`/clients/${s}`,l),kt=(s,l={})=>T.delete(`/clients/${s}`,{data:l}),xt=(s,l={})=>T.post(`/clients/${s}/cert`,l),ye=s=>T.get(`/clients/${s}/cert/exported`),Ct=s=>T.post(`/clients/${s}/disconnect`),be=(s={})=>T.get("/clients/validate",{params:s}),Vt={class:"page"},ht={class:"toolbar"},$t={class:"filters"},zt={class:"pagination"},Ot={__name:"ClientsView",setup(s){const l=z([]),r=z(!1),p=z(!1),u=z(!1),_=z(10),c=[10,20,50,100],S=z(1),n=fe({id:null,name:"client-01",common_name:"client-01",fixed_ip:"10.8.0.10",routes:"",status:"offline"}),b=fe({nameOk:null,commonNameOk:null,fixedIpOk:null,nameMessage:"",commonNameMessage:"",fixedIpMessage:""}),N=f=>f.status==="online"?"success":f.status==="disabled"?"danger":"info",m=z(0),d=E(()=>Math.max(1,Math.ceil(m.value/_.value)||1)),I=E(()=>l.value),U=z(""),y=z(""),v=async()=>{r.value=!0;try{const{data:f}=await yt({page:S.value,page_size:_.value,name:U.value||void 0,status:y.value||void 0});l.value=f.items,m.value=f.total,F()}catch(f){h.error(f.message)}finally{r.value=!1}},g=()=>{Object.assign(n,{id:null,name:"client-01",common_name:"client-01",fixed_ip:"10.8.0.10",routes:"",status:"offline",disabled:!1}),u.value=!1,Z(),p.value=!0},w=f=>{Object.assign(n,f),u.value=!0,Z(),p.value=!0},R=async()=>{try{if(!n.name||!n.common_name||!n.fixed_ip)throw new Error("名称、证书CN、固定IP均为必填");if(await te(!0),u.value)await wt(n.id,{fixed_ip:n.fixed_ip,routes:n.routes,status:n.status}),h.success("已更新");else{const{value:f}=await le.prompt("请输入 CA 口令，用于生成客户端证书","需要口令",{inputType:"password",inputPlaceholder:"CA 私钥口令（如无可留空）",confirmButtonText:"确认创建",cancelButtonText:"取消",closeOnClickModal:!1}),a=f==null?void 0:f.trim();await bt({name:n.name,common_name:n.common_name,fixed_ip:n.fixed_ip||null,routes:n.routes||null,status:n.status,passphrase:a||null}),h.success("已创建")}p.value=!1,v()}catch(f){h.error(f.message)}},L=async f=>{try{const{data:a}=await ye(f.id);let P=null;if(a!=null&&a.exists){const{value:x}=await le.prompt("检测到已生成证书和 .ovpn，需吊销后再删除。请输入 CA 口令（如无可留空）","吊销并删除",{inputType:"password",inputPlaceholder:"CA 私钥口令（如无可留空）",confirmButtonText:"确认",cancelButtonText:"取消",closeOnClickModal:!1});P=(x==null?void 0:x.trim())||null}else await le.confirm("未生成证书，直接删除数据库记录，确认继续？","确认删除",{type:"warning",confirmButtonText:"删除",cancelButtonText:"取消"});await kt(f.id,{passphrase:P}),h.success("已删除"),v()}catch(a){if(a==="cancel"||a==="close")return;h.error(a.message)}},J=async f=>{try{await Ct(f.id),h.success("已下线"),await v()}catch(a){h.error(a.message)}},X=async f=>{try{const{data:a}=await ye(f.id);let P=a.ovpn;if(!a.exists||!P){const{value:q}=await le.prompt("请输入 CA 口令，用于签发客户端证书","需要口令",{inputType:"password",inputPlaceholder:"CA 私钥口令（如无可留空）",confirmButtonText:"生成并下载",cancelButtonText:"取消",closeOnClickModal:!1}),ce=q==null?void 0:q.trim(),{data:pe}=await xt(f.id,{passphrase:ce||null});P=pe.ovpn}if(!P)throw new Error("未获取到配置内容");const x=new Blob([P],{type:"application/x-openvpn-profile"}),K=window.URL.createObjectURL(x),A=document.createElement("a");A.href=K,A.download=`${f.name||f.common_name||"client"}.ovpn`,document.body.appendChild(A),A.click(),A.remove(),window.URL.revokeObjectURL(K),h.success(a.exists?"已直接下载现有配置":"已生成并下载配置")}catch(a){if(a==="cancel"||a==="close")return;h.error(a.message)}},F=()=>{const f=d.value;S.value>f&&(S.value=f,v())},Y=()=>{S.value=1,v()},G=()=>{v()},D=()=>{S.value=1,v()},ee=()=>{U.value="",y.value="",D()},Z=()=>{b.nameOk=null,b.commonNameOk=null,b.fixedIpOk=null,b.nameMessage="",b.commonNameMessage="",b.fixedIpMessage=""},M=(f,a,P)=>{f==="name"?(b.nameOk=a,b.nameMessage=P||""):f==="common_name"?(b.commonNameOk=a,b.commonNameMessage=P||""):f==="fixed_ip"&&(b.fixedIpOk=a,b.fixedIpMessage=P||"")},V=async(f,a=!1)=>{const P={};if(f==="name"&&n.name&&(P.name=n.name.trim()),f==="common_name"&&n.common_name&&(P.common_name=n.common_name.trim()),f==="fixed_ip"&&n.fixed_ip&&(P.fixed_ip=n.fixed_ip.trim()),Object.keys(P).length!==0)try{const{data:x}=await be(P);f==="name"?(M("name",x.name_ok!==!1,x.name_message),a&&h[x.name_ok?"success":"warning"](x.name_message||(x.name_ok?"名称可用":"名称已存在"))):f==="common_name"?(M("common_name",x.common_name_ok!==!1,x.common_name_message),a&&h[x.common_name_ok?"success":"warning"](x.common_name_message||(x.common_name_ok?"证书CN可用":"证书CN已存在"))):f==="fixed_ip"&&(M("fixed_ip",x.fixed_ip_ok!==!1,x.fixed_ip_message),a&&h[x.fixed_ip_ok?"success":"warning"](x.fixed_ip_message||(x.fixed_ip_ok?"固定IP可用":"固定IP不可用")))}catch(x){h.error(x.message)}},te=async(f=!1)=>{var P,x,K;const{data:a}=await be({name:(P=n.name)==null?void 0:P.trim(),common_name:(x=n.common_name)==null?void 0:x.trim(),fixed_ip:(K=n.fixed_ip)==null?void 0:K.trim()});if(M("name",a.name_ok!==!1,a.name_message),M("common_name",a.common_name_ok!==!1,a.common_name_message),M("fixed_ip",a.fixed_ip_ok!==!1,a.fixed_ip_message),f&&(a.name_message&&h[a.name_ok?"success":"warning"](a.name_message),a.common_name_message&&h[a.common_name_ok?"success":"warning"](a.common_name_message),a.fixed_ip_message&&h[a.fixed_ip_ok?"success":"warning"](a.fixed_ip_message)),a.name_ok===!1||a.common_name_ok===!1||a.fixed_ip_ok===!1)throw new Error(a.name_message||a.common_name_message||a.fixed_ip_message||"校验未通过")},de=Ne(f=>{V(f,!0)},300);return se(v),(f,a)=>{const P=o("el-input"),x=o("el-option"),K=o("el-select"),A=o("el-button"),q=o("el-table-column"),ce=o("el-tag"),pe=o("el-table"),Ce=o("el-pagination"),ae=o("el-form-item"),Ve=o("el-form"),he=o("el-dialog"),$e=ue("loading");return O(),B("div",Vt,[i("div",ht,[i("div",$t,[e(P,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=C=>U.value=C),placeholder:"按名称搜索",clearable:"",size:"small",style:{width:"200px"},onClear:D,onKeyup:ke(D,["enter","native"])},null,8,["modelValue"]),e(K,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=C=>y.value=C),placeholder:"状态",clearable:"",size:"small",style:{width:"140px"},onChange:D},{default:t(()=>[e(x,{label:"在线",value:"online"}),e(x,{label:"离线",value:"offline"}),e(x,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"]),e(A,{size:"small",type:"primary",onClick:D},{default:t(()=>[...a[14]||(a[14]=[k("查询",-1)])]),_:1}),e(A,{size:"small",onClick:ee},{default:t(()=>[...a[15]||(a[15]=[k("重置",-1)])]),_:1})]),e(A,{type:"primary",onClick:g},{default:t(()=>[...a[16]||(a[16]=[k("新增客户端",-1)])]),_:1})]),ne((O(),j(pe,{data:I.value,style:{width:"100%"}},{default:t(()=>[e(q,{prop:"name",label:"名称"}),e(q,{prop:"common_name",label:"证书CN"}),e(q,{prop:"fixed_ip",label:"固定IP",width:"140"}),e(q,{prop:"routes",label:"路由"}),e(q,{label:"状态",width:"110"},{default:t(({row:C})=>[e(ce,{type:N(C)},{default:t(()=>[k($(C.status),1)]),_:2},1032,["type"])]),_:1}),e(q,{label:"操作",width:"360"},{default:t(({row:C})=>[e(A,{size:"small",onClick:me=>w(C)},{default:t(()=>[...a[17]||(a[17]=[k("编辑",-1)])]),_:1},8,["onClick"]),e(A,{size:"small",type:"success",onClick:me=>X(C)},{default:t(()=>[...a[18]||(a[18]=[k("下载",-1)])]),_:1},8,["onClick"]),e(A,{size:"small",type:"warning",disabled:C.status!=="online",onClick:me=>J(C)},{default:t(()=>[...a[19]||(a[19]=[k(" 强制下线 ",-1)])]),_:1},8,["disabled","onClick"]),e(A,{size:"small",type:"danger",onClick:me=>L(C)},{default:t(()=>[...a[20]||(a[20]=[k("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$e,r.value]]),i("div",zt,[e(Ce,{"current-page":S.value,"onUpdate:currentPage":a[2]||(a[2]=C=>S.value=C),"page-size":_.value,"onUpdate:pageSize":a[3]||(a[3]=C=>_.value=C),"page-sizes":c,"page-count":d.value,layout:"total, sizes, prev, pager, next, jumper",total:l.value.length,onSizeChange:Y,onCurrentChange:G},null,8,["current-page","page-size","page-count","total"])]),e(he,{modelValue:p.value,"onUpdate:modelValue":a[13]||(a[13]=C=>p.value=C),title:u.value?"编辑客户端":"新增客户端",width:"520px"},{footer:t(()=>[e(A,{onClick:a[12]||(a[12]=C=>p.value=!1)},{default:t(()=>[...a[21]||(a[21]=[k("取消",-1)])]),_:1}),e(A,{type:"primary",onClick:R},{default:t(()=>[k($(u.value?"保存":"创建"),1)]),_:1})]),default:t(()=>[e(Ve,{model:n,"label-width":"120px"},{default:t(()=>[e(ae,{label:"名称",required:""},{default:t(()=>[e(P,{modelValue:n.name,"onUpdate:modelValue":a[4]||(a[4]=C=>n.name=C),disabled:u.value,placeholder:"如：client-01",onBlur:a[5]||(a[5]=C=>W(de)("name"))},null,8,["modelValue","disabled"]),b.nameOk!==null&&b.nameMessage?(O(),B("div",{key:0,class:_e(["field-tip",b.nameOk?"ok":"err"])},$(b.nameMessage),3)):Q("",!0)]),_:1}),e(ae,{label:"证书CN",required:""},{default:t(()=>[e(P,{modelValue:n.common_name,"onUpdate:modelValue":a[6]||(a[6]=C=>n.common_name=C),disabled:u.value,placeholder:"如：client-01",onBlur:a[7]||(a[7]=C=>W(de)("common_name"))},null,8,["modelValue","disabled"]),b.commonNameOk!==null&&b.commonNameMessage?(O(),B("div",{key:0,class:_e(["field-tip",b.commonNameOk?"ok":"err"])},$(b.commonNameMessage),3)):Q("",!0)]),_:1}),e(ae,{label:"固定IP",required:""},{default:t(()=>[e(P,{modelValue:n.fixed_ip,"onUpdate:modelValue":a[8]||(a[8]=C=>n.fixed_ip=C),placeholder:"10.8.0.x（必须在 server.conf 网段内）",onBlur:a[9]||(a[9]=C=>W(de)("fixed_ip"))},null,8,["modelValue"]),b.fixedIpOk!==null&&b.fixedIpMessage?(O(),B("div",{key:0,class:_e(["field-tip",b.fixedIpOk?"ok":"err"])},$(b.fixedIpMessage),3)):Q("",!0)]),_:1}),e(ae,{label:"路由(逗号分隔)"},{default:t(()=>[e(P,{modelValue:n.routes,"onUpdate:modelValue":a[10]||(a[10]=C=>n.routes=C),placeholder:"192.168.1.0/24,10.0.0.0/24"},null,8,["modelValue"])]),_:1}),e(ae,{label:"状态"},{default:t(()=>[e(K,{modelValue:n.status,"onUpdate:modelValue":a[11]||(a[11]=C=>n.status=C)},{default:t(()=>[e(x,{label:"在线",value:"online"}),e(x,{label:"离线",value:"offline"}),e(x,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Nt=H(Ot,[["__scopeId","data-v-0d42a38d"]]),St=(s={})=>T.get("/logs/audit",{params:s}),Mt={class:"page"},Pt={class:"panel-header"},It={class:"filters"},Bt={class:"pagination"},Tt={__name:"LogsView",setup(s){const l=z([]),r=z(!1),p=z(0),u=z(1),_=z(20),c=z([20,50,100,200]),S=z(""),n=z([]),b=z({user_login:"用户登录",client_login:"客户端上线",client_logout:"客户端下线",client_disconnect:"强制下线",create_client:"创建客户端",delete_client:"删除客户端",revoke_client_cert:"吊销证书"}),N=async()=>{r.value=!0;try{const g={page:u.value,page_size:_.value,action:S.value||void 0};n.value&&n.value.length===2&&(g.start_time=n.value[0],g.end_time=n.value[1]);const{data:w}=await St(g);l.value=w.items||[],p.value=w.total||0}catch(g){h.error(g.message)}finally{r.value=!1}},m=()=>{u.value=1,N()},d=()=>{N()},I=()=>{u.value=1,N()},U=()=>{S.value="",n.value=[],I()},y=re,v=g=>b.value[g]||g;return se(N),(g,w)=>{const R=o("el-option"),L=o("el-select"),J=o("el-date-picker"),X=o("el-button"),F=o("el-table-column"),Y=o("el-tag"),G=o("el-table"),D=o("el-pagination"),ee=o("el-card"),Z=ue("loading");return O(),B("div",Mt,[e(ee,{shadow:"never"},{header:t(()=>[i("div",Pt,[w[6]||(w[6]=i("span",null,"审计日志",-1)),i("div",It,[e(L,{modelValue:S.value,"onUpdate:modelValue":w[0]||(w[0]=M=>S.value=M),placeholder:"动作",clearable:"",filterable:"",size:"small",style:{width:"200px"},onChange:I},{default:t(()=>[(O(!0),B(oe,null,ie(b.value,(M,V)=>(O(),j(R,{key:V,label:M,value:V},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(J,{modelValue:n.value,"onUpdate:modelValue":w[1]||(w[1]=M=>n.value=M),type:"datetimerange","value-format":"YYYY-MM-DDTHH:mm:ss","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",size:"small",clearable:"",onChange:I},null,8,["modelValue"]),e(X,{size:"small",type:"primary",onClick:I},{default:t(()=>[...w[4]||(w[4]=[k("查询",-1)])]),_:1}),e(X,{size:"small",onClick:U},{default:t(()=>[...w[5]||(w[5]=[k("重置",-1)])]),_:1})])])]),default:t(()=>[ne((O(),j(G,{data:l.value,size:"small","empty-text":"暂无日志"},{default:t(()=>[e(F,{prop:"created_at",label:"时间",width:"180"},{default:t(({row:M})=>[k($(W(y)(M.created_at)),1)]),_:1}),e(F,{prop:"actor",label:"操作者",width:"140"}),e(F,{prop:"action",label:"动作",width:"160"},{default:t(({row:M})=>[e(Y,{size:"small",type:"info"},{default:t(()=>[k($(v(M.action)),1)]),_:2},1024)]),_:1}),e(F,{prop:"target",label:"目标"}),e(F,{prop:"result",label:"结果",width:"120"},{default:t(({row:M})=>[e(Y,{type:M.result==="success"?"success":"danger"},{default:t(()=>[k($(M.result),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[Z,r.value]]),i("div",Bt,[e(D,{"current-page":u.value,"onUpdate:currentPage":w[2]||(w[2]=M=>u.value=M),"page-size":_.value,"onUpdate:pageSize":w[3]||(w[3]=M=>_.value=M),"page-sizes":c.value,layout:"total, sizes, prev, pager, next, jumper",total:p.value,onSizeChange:m,onCurrentChange:d},null,8,["current-page","page-size","page-sizes","total"])])]),_:1})])}}},Ut=H(Tt,[["__scopeId","data-v-64d5aeff"]]),At=(s,l)=>T.post("/auth/login",new URLSearchParams({username:s,password:l}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),Lt={class:"login-card"},Et={__name:"LoginView",setup(s){const l=we(),r=z(!1),p=fe({username:"",password:""}),u=async()=>{if(!p.username||!p.password){h.warning("请输入用户名和密码");return}r.value=!0;try{const{data:_}=await At(p.username,p.password);localStorage.setItem("token",_.access_token),localStorage.setItem("username",p.username),h.success("登录成功"),l.push("/")}catch(_){h.error(_.message)}finally{r.value=!1}};return(_,c)=>{const S=o("el-input"),n=o("el-form-item"),b=o("el-button"),N=o("el-form");return O(),B("div",Lt,[c[3]||(c[3]=i("div",{class:"logo"},"OpenVPN Web 管理",-1)),e(N,{model:p,onKeyup:ke(u,["enter"]),"label-position":"top"},{default:t(()=>[e(n,{label:"用户名"},{default:t(()=>[e(S,{modelValue:p.username,"onUpdate:modelValue":c[0]||(c[0]=m=>p.username=m),autocomplete:"username"},null,8,["modelValue"])]),_:1}),e(n,{label:"密码"},{default:t(()=>[e(S,{modelValue:p.password,"onUpdate:modelValue":c[1]||(c[1]=m=>p.password=m),type:"password",autocomplete:"current-password","show-password":""},null,8,["modelValue"])]),_:1}),e(b,{type:"primary",loading:r.value,class:"full-btn",onClick:u},{default:t(()=>[...c[2]||(c[2]=[k("登录",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])])}}},Dt=H(Et,[["__scopeId","data-v-1df02f83"]]),Rt=()=>T.get("/openvpn/status"),jt=s=>T.post(`/openvpn/${s}`),Ft={class:"page"},qt={class:"toolbar"},Kt={__name:"OpenVPNControlView",setup(s){const l=z(!1),r=z("尚未查询"),p=async()=>{l.value=!0;try{const{data:_}=await Rt();r.value=_.result||JSON.stringify(_,null,2)}catch(_){h.error(_.message)}finally{l.value=!1}},u=async _=>{l.value=!0;try{const{data:c}=await jt(_);r.value=c.result||JSON.stringify(c,null,2),h.success(`${_} 成功`)}catch(c){h.error(c.message)}finally{l.value=!1}};return se(p),(_,c)=>{const S=o("el-button"),n=o("el-input"),b=o("el-card");return O(),B("div",Ft,[i("div",qt,[e(S,{onClick:p,loading:l.value},{default:t(()=>[...c[4]||(c[4]=[k("刷新状态",-1)])]),_:1},8,["loading"]),e(S,{type:"success",onClick:c[0]||(c[0]=N=>u("start")),loading:l.value},{default:t(()=>[...c[5]||(c[5]=[k("启动",-1)])]),_:1},8,["loading"]),e(S,{type:"warning",onClick:c[1]||(c[1]=N=>u("restart")),loading:l.value},{default:t(()=>[...c[6]||(c[6]=[k("重启",-1)])]),_:1},8,["loading"]),e(S,{type:"danger",onClick:c[2]||(c[2]=N=>u("stop")),loading:l.value},{default:t(()=>[...c[7]||(c[7]=[k("停止",-1)])]),_:1},8,["loading"])]),e(b,{shadow:"never"},{header:t(()=>[...c[8]||(c[8]=[i("div",{class:"panel-header"},[i("span",null,"OpenVPN 服务状态")],-1)])]),default:t(()=>[e(n,{type:"textarea",rows:10,modelValue:r.value,"onUpdate:modelValue":c[3]||(c[3]=N=>r.value=N),readonly:""},null,8,["modelValue"])]),_:1})])}}},Yt=H(Kt,[["__scopeId","data-v-16d7546f"]]),Wt=[{path:"/login",name:"login",component:Dt},{path:"/",name:"dashboard",component:lt},{path:"/servers",name:"servers",component:gt},{path:"/clients",name:"clients",component:Nt},{path:"/logs",name:"logs",component:Ut},{path:"/openvpn",name:"openvpn",component:Yt}],ve="/ovpnmanager/",xe=Se({history:Me(ve),routes:Wt}),Ht=["/login"],Jt=s=>s.startsWith(ve)?s.slice(ve.length-1)||"/":s;xe.beforeEach((s,l,r)=>{const p=localStorage.getItem("token"),u=Jt(s.path);return!p&&!Ht.includes(u)?r("/login"):p&&u==="/login"?r("/"):r()});const ge=Pe(Le);ge.use(xe);ge.use(Ie);ge.mount("#app");
